<?php

class Event extends BaseModel implements IHasIcon, IHasLink {
	use HasLocalizedData, HasIcon, HasLink;

	public function map() {
	    return $this->belongsTo(Map::class);
    }

	public function getName($lang = null) {
		return $this->localized('name', $lang);
	}

	public function getNameWithoutDot($lang = null) {
	    $name = $this->getName($lang);

	    if(ends_with($name, '.')) {
	        return substr($name, 0, -1);
        }

        return $name;
    }

	public function getIconUrl($size = 64) {
	    if(!$this->signature || !$this->file_id) {
	        return $this->getInternalIconUrl($size, '98EB189CADF825549B187C57B551CE1AA29CA694', 102320);
        }

		return $this->getInternalIconUrl($size, $this->signature, $this->file_id);
	}

	public function getKarmaIconUrl($size = 64) {
        return $this->getInternalIconUrl($size, '94953FA23D3E0D23559624015DFEA4CFAA07F0E5', 155026);
    }

    public function getKarmaIcon($size = 64) {
        $attributes = [
            'src' => $this->getKarmaIconUrl($size),
            'width' => $size,
            'height' => $size,
            'alt' => '',
            'crossorigin' => 'anonymous'
        ];

        if($size <= 32) {
            $attributes['srcset'] = $this->getKarmaIconUrl($size*2).' 2x';
        }

        return '<img '.HTML::attributes($attributes).'>';
    }

    public function getAdditionalLinkAttributes(array $defaults = []) {
		return ['data-event-id' => $this->id];
	}

	public function getUrl($lang = null) {
		if(is_null($lang)) {
			$lang = App::getLocale();
		}

		return route('event.details', ['language' => $lang, 'event' => $this->id]);
	}

	public function getRewards() {
	    return [
             0 => [    0,   0,  0,     0,   0,  0,     0,   0,  0],
             1 => [  294,  23,  5,   250,  20,  4,   221,  17,  4],
             2 => [  515,  27,  6,   438,  23,  5,   386,  21,  5],
             3 => [  327,  32,  7,   278,  27,  6,   245,  24,  5],
             4 => [  344,  36,  8,   293,  31,  7,   258,  27,  6],
             5 => [  364,  41,  9,   309,  35,  8,   273,  31,  7],
             6 => [  601,  45, 10,   511,  39,  9,   451,  34,  8],
             7 => [  403,  50, 11,   343,  43, 10,   303,  38,  9],
             8 => [  425,  54, 12,   362,  46, 11,   319,  41,  9],
             9 => [  664,  58, 14,   381,  50, 12,   336,  44, 10],
            10 => [  472,  63, 14,   402,  54, 12,   354,  48, 11],
            11 => [  497,  68, 16,   423,  58, 13,   373,  51, 12],
            12 => [  525,  72, 17,   446,  62, 14,   394,  54, 13],
            13 => [  552,  77, 18,   470,  66, 15,   414,  58, 13],
            14 => [  583,  81, 19,   495,  69, 16,   437,  61, 14],
            15 => [  613,  86, 20,   522,  73, 17,   460,  65, 15],
            16 => [  647,  90, 21,   550,  77, 18,   485,  68, 16],
            17 => [  682,  95, 22,   580,  81, 19,   512,  71, 17],
            18 => [  719,  99, 23,   611,  85, 20,   539,  75, 17],
            19 => [  758, 104, 24,   644,  88, 20,   568,  78, 18],
            20 => [  802, 108, 25,   681,  92, 21,   601,  81, 19],
            21 => [  838, 112, 26,   713,  96, 22,   629,  85, 20],
            22 => [  890, 117, 27,   756, 100, 23,   668,  88, 20],
            23 => [  934, 122, 28,   794, 104, 24,   701,  92, 21],
            24 => [  985, 126, 29,   838, 108, 25,   739,  95, 22],
            25 => [ 1037, 130, 30,   881, 111, 26,   778,  98, 23],
            26 => [ 1096, 135, 31,   931, 115, 27,   822, 102, 24],
            27 => [ 1154, 140, 33,   981, 119, 28,   866, 105, 24],
            28 => [ 1213, 144, 34,  1031, 123, 28,   910, 108, 25],
            29 => [ 1279, 149, 34,  1088, 127, 29,   960, 111, 26],
            30 => [ 1346, 153, 36,  1144, 131, 30,  1009, 115, 27],
            31 => [ 1419, 158, 37,  1206, 134, 31,  1064, 119, 28],
            32 => [ 1500, 162, 38,  1275, 138, 32,  1125, 122, 28],
            33 => [ 1581, 167, 39,  1344, 142, 33,  1186, 125, 29],
            34 => [ 1662, 171, 40,  1412, 146, 34,  1246, 129, 30],
            35 => [ 1757, 176, 41,  1494, 150, 35,  1318, 132, 31],
            36 => [ 1845, 180, 42,  1569, 153, 36,  1384, 135, 31],
            37 => [ 1948, 185, 43,  1656, 157, 36,  1461, 139, 32],
            38 => [ 2051, 189, 44,  1744, 161, 37,  1538, 142, 33],
            39 => [ 2161, 194, 45,  1837, 165, 38,  1621, 146, 34],
            40 => [ 2279, 198, 46,  1937, 169, 39,  1709, 149, 35],
            41 => [ 2404, 203, 47,  2043, 173, 40,  1803, 152, 35],
            42 => [ 2536, 207, 48,  2156, 176, 41,  1902, 156, 36],
            43 => [ 2669, 212, 49,  2268, 180, 42,  2002, 159, 37],
            44 => [ 2816, 216, 50,  2393, 184, 43,  2112, 162, 38],
            45 => [ 2963, 221, 51,  2518, 188, 44,  2222, 166, 39],
            46 => [ 3124, 225, 52,  2656, 192, 45,  2343, 169, 39],
            47 => [ 3293, 230, 53,  2799, 196, 45,  2470, 173, 40],
            48 => [ 3470, 234, 54,  2949, 199, 46,  2602, 176, 41],
            49 => [ 3661, 239, 55,  3112, 203, 47,  2746, 179, 42],
            50 => [ 3859, 243, 56,  3280, 207, 48,  2895, 183, 42],
            51 => [ 4065, 248, 58,  3455, 211, 49,  3049, 186, 43],
            52 => [ 4286, 252, 59,  3643, 215, 50,  3214, 189, 44],
            53 => [ 4513, 257, 60,  3836, 219, 51,  3385, 193, 45],
            54 => [ 4756, 261, 61,  4043, 222, 52,  3567, 196, 46],
            55 => [ 5013, 266, 62,  4261, 226, 53,  3760, 200, 46],
            56 => [ 5285, 270, 63,  4492, 230, 53,  3964, 203, 47],
            57 => [ 5572, 275, 64,  4736, 234, 54,  4179, 206, 48],
            58 => [ 5866, 279, 65,  4986, 238, 55,  4399, 210, 49],
            59 => [ 6182, 284, 66,  5255, 241, 56,  4637, 213, 50],
            60 => [ 6520, 288, 67,  5542, 245, 57,  4890, 216, 50],
            61 => [ 6873, 293, 68,  5842, 249, 58,  5155, 220, 51],
            62 => [ 7240, 297, 69,  6154, 253, 59,  5430, 223, 52],
            63 => [ 7644, 302, 70,  6498, 257, 60,  5733, 227, 53],
            64 => [ 8012, 306, 71,  6810, 261, 61,  6009, 230, 54],
            65 => [ 8453, 311, 72,  7185, 264, 61,  6340, 233, 54],
            66 => [ 8967, 315, 73,  7622, 268, 62,  6726, 237, 55],
            67 => [ 9408, 320, 74,  7997, 272, 63,  7056, 240, 56],
            68 => [ 9923, 324, 75,  8435, 276, 64,  7442, 243, 57],
            69 => [10437, 329, 76,  8872, 280, 65,  7828, 247, 57],
            70 => [11025, 333, 77,  9372, 284, 66,  8269, 250, 58],
            71 => [11613, 338, 79,  9872, 287, 67,  8710, 254, 59],
            72 => [12275, 342, 80, 10434, 291, 68,  9206, 257, 60],
            73 => [12936, 347, 81, 10996, 295, 69,  9702, 260, 61],
            74 => [13598, 351, 82, 11558, 299, 70, 10199, 264, 61],
            75 => [14333, 356, 83, 12183, 303, 70, 10750, 267, 62],
            76 => [15068, 360, 84, 12808, 306, 71, 11301, 270, 63],
            77 => [15950, 365, 85, 13558, 310, 72, 11963, 274, 64],
            78 => [16758, 369, 86, 14245, 314, 73, 12569, 277, 65],
            79 => [17714, 374, 87, 15057, 318, 74, 13286, 281, 65],
            80 => [26670, 378, 88, 20003, 284, 66, 13335, 189, 44],
        ][$this->level];
    }
}
