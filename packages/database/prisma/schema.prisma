generator client {
  provider = "prisma-client-js"
  output   = "../.prisma"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Item {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  rarity      Rarity
  type        String  @default("")
  subtype     String?
  weight      String?
  vendorValue Int?
  level       Int      @default(0)

  // tp
  tpTradeable   Boolean @default(false)
  tpWhitelisted Boolean @default(false)
  buyQuantity   Int?
  buyPrice      Int?
  sellQuantity  Int?
  sellPrice     Int?
  tpCheckedAt   DateTime?
  tpHistory     TradingPostHistory_Trend[]

  // legendary armory
  legendaryArmoryMaxCount Int?

  // skins
  unlocksSkin    Skin[]
  unlocksSkinIds Int[]

  // recipes
  recipeOutput     Recipe[] @relation(name: "recipe_output")
  ingredient       RecipeIngredient[]

  unlocksRecipe    Recipe[] @relation(name: "unlocks_recipe")
  unlocksRecipeIds Int[]

  // mystic forge recipes
  mysticForgeRecipeOutput MysticForgeRecipe[]         @relation("mystic_forge_output")
  mysticForgeIngredient   MysticForgeIngredientItem[] @relation("mystic_forge_ingredient")

  // achievements
  achievementRewards Achievement[] @relation(name: "rewards_item")
  achievementBits    Achievement[] @relation(name: "bits_item")

  // items
  suffixItems   Item[] @relation(name: "suffix")
  suffixItemIds Int[]
  suffixIn      Item[] @relation(name: "suffix")

  contains    Content[] @relation("contains")
  containedIn Content[] @relation("containedIn")

  // currency
  containsCurrency CurrencyContent[] @relation("containsCurrency")

  // color
  unlocksColor    Color[]  @relation("unlocks_color")
  unlocksColorIds Int[]

  // guild upgrades
  unlocksGuildUpgrade    GuildUpgrade[]  @relation("unlocks_guild_upgrade")
  unlocksGuildUpgradeIds Int[]

  // wizardsvault
  wizardsVaultListings WizardsVaultListing[] @relation("wizardsvault_listing")

  // homestead glyph
  homesteadGlyphs HomesteadGlyph[] @relation("homestead_glyph")

  // minis
  unlocksMinis   Mini[] @relation("unlock")
  unlocksMiniIds Int[] 

  // review queue
  reviews Review[] @relation("itemReview")

  // flag if the item is no longer available in the API
  removedFromApi Boolean @default(false)

  // item views (last 7 days) and relevancy score
  views     Int   @default(0)
  relevancy Float @default(0)

  // history
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history ItemHistory[]
  
  // last time checked for updates
  lastCheckedAt  DateTime   @default(now())

  // common timestamps
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  // migration version
  version Int @default(0)

  @@index([createdAt])
  @@index([name_de(ops: raw("gin_trgm_ops")), name_en(ops: raw("gin_trgm_ops")), name_es(ops: raw("gin_trgm_ops")), name_fr(ops: raw("gin_trgm_ops"))], type: Gin)
}

enum Rarity {
  Junk
  Basic
  Fine
  Masterwork
  Rare
  Exotic
  Ascended
  Legendary
}

model TradingPostHistory {
  itemId Int
  time   DateTime @default(now())

  buyQuantity   Int?
  buyPrice      Int?
  sellQuantity  Int?
  sellPrice     Int?
  
  @@unique([itemId,  time])
}

view TradingPostHistory_Trend {
  itemId Int
  time   DateTime @default(now())

  buyQuantity   Int?
  buyPrice      Int?
  sellQuantity  Int?
  sellPrice     Int?

  item Item @relation(fields: [itemId], references: [id])
  
  @@unique([itemId,  time])
}

model Icon {
  id Int @id
  signature String
  
  color String?

  items Item[]
  skills Skill[]
  skins Skin[]
  achievements Achievement[]
  achievementCategories AchievementCategory[]
  currencies Currency[]
  guildUpgrades GuildUpgrade[]
  homesteadDecorations HomesteadDecoration[]
  minis Mini[]
}

model Content {
  containerItemId Int
  contentItemId   Int

  quantity Int
  chance ContentChance

  containerItem Item @relation("contains", fields: [containerItemId], references: [id])
  contentItem   Item @relation("containedIn", fields: [contentItemId], references: [id])

  @@id([containerItemId, contentItemId])
}

enum ContentChance {
  Chance
  Choice
  Guaranteed
}

model CurrencyContent {
  containerItemId Int
  currencyId      Int

  min Int
  max Int

  containerItem Item     @relation("containsCurrency", fields: [containerItemId], references: [id])
  currency      Currency @relation("containedCurrency", fields: [currencyId], references: [id])

  @@id([containerItemId, currencyId])
}

model ItemHistory {
  itemId Int
  revisionId String @unique

  item Item @relation(fields: [itemId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([itemId, revisionId])
}

model Skill {
  id Int @id
  
  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  removedFromApi Boolean @default(false)
  
  views Int @default(0)

  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history SkillHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)


  @@index([createdAt])
  @@index([name_de(ops: raw("gin_trgm_ops")), name_en(ops: raw("gin_trgm_ops")), name_es(ops: raw("gin_trgm_ops")), name_fr(ops: raw("gin_trgm_ops"))], type: Gin)
}

model SkillHistory {
  skillId Int
  revisionId String

  skill Skill @relation(fields: [skillId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([skillId, revisionId])
}

model Skin {
  id Int @id
  
  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  rarity  Rarity
  type    String  @default("")
  subtype String?
  weight  String?

  unlockedByItems Item[]
  achievementBits Achievement[] @relation(name: "bits_skin")

  unlocks Float?

  wikiImage String?
  wikiImageType WikiImageType?

  set   SkinSet? @relation(fields: [setId], references: [id], onDelete: SetNull)
  setId String?

  removedFromApi Boolean @default(false)
  
  views Int @default(0)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history SkinHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)

  
  @@index([createdAt])
  @@index([name_de(ops: raw("gin_trgm_ops")), name_en(ops: raw("gin_trgm_ops")), name_es(ops: raw("gin_trgm_ops")), name_fr(ops: raw("gin_trgm_ops"))], type: Gin)
}

enum WikiImageType {
  Skin
  Set
}

model SkinSet {
  id String @id @default(uuid())

  name_en String @unique

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  skins Skin[]
}

model SkinHistory {
  skinId Int
  revisionId String

  skin Skin @relation(fields: [skinId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([skinId, revisionId])
}

model Recipe {
  id Int @id

  type        String
  rating      Int
  disciplines String[]

  outputCount   Int
  timeToCraftMs Int

  flags String[] @default([])

  unlockedByItems Item[] @relation(name: "unlocks_recipe")

  outputItemId    Int?
  outputItem      Item? @relation(name: "recipe_output", fields: [outputItemId], references: [id])
  outputItemIdRaw Int?

  outputGuildUpgradeId    Int?
  outputGuildUpgrade      GuildUpgrade? @relation(name: "recipe_output", fields: [outputGuildUpgradeId], references: [id])
  outputGuildUpgradeIdRaw Int?

  ingredients RecipeIngredient[]

  ingredientCount Int?

  removedFromApi Boolean @default(false)
  
  current   Revision @relation("current", fields: [currentId], references: [id], onDelete: Cascade)
  currentId String @unique

  history RecipeHistory[]

  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model RecipeHistory {
  recipeId Int
  revisionId String

  recipe Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([recipeId, revisionId])
}

model RecipeIngredient {
  recipeId     Int
  ingredientId Int
  type         RecipeIngredientType

  count Int

  recipe Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  item   Item? @relation(fields: [itemId], references: [id], onDelete: SetNull)
  itemId Int?
  
  currency   Currency? @relation(fields: [currencyId], references: [id], onDelete: SetNull)
  currencyId Int?

  guildUpgrade   GuildUpgrade? @relation(fields: [guildUpgradeId], references: [id], onDelete: SetNull)
  guildUpgradeId Int?

  @@id([recipeId, type, ingredientId])
}

enum RecipeIngredientType {
  Item
  Currency
  GuildUpgrade
}

model MysticForgeRecipe {
  id String @id @default(uuid())

  outputCountMin Int
  outputCountMax Int

  outputItemId    Int
  outputItem      Item @relation("mystic_forge_output", fields: [outputItemId], references: [id])

  itemIngredients MysticForgeIngredientItem[]

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model MysticForgeIngredientItem {
  id String @id @default(uuid())

  mysticForgeRecipeId String
  itemId              Int

  count Int

  Recipe MysticForgeRecipe @relation(fields: [mysticForgeRecipeId], references: [id], onDelete: Cascade)
  Item   Item              @relation("mystic_forge_ingredient", fields: [itemId], references: [id], onDelete: Cascade)
}

model Achievement {
  id Int @id
  
  name_de String
  name_en String
  name_es String
  name_fr String

  historic Boolean        @default(true)
  points   Int            @default(0)
  mastery  MasteryRegion?

  flags String[]

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  achievementCategory AchievementCategory? @relation("achievements", fields: [achievementCategoryId], references: [id])
  achievementCategoryId Int?

  isCategoryDisplay Boolean @default(false)
  categoryDisplayFor AchievementCategory[] @relation("categoryDisplay")

  prerequisites    Achievement[] @relation(name: "prerequisites")
  prerequisitesIds Int[]
  prerequisiteFor  Achievement[] @relation(name: "prerequisites")

  bitsItem    Item[] @relation(name: "bits_item")
  bitsItemIds Int[]

  bitsSkin    Skin[] @relation(name: "bits_skin")
  bitsSkinIds Int[]

  bitsMini    Mini[] @relation(name: "bits_mini")
  bitsMiniIds Int[]

  rewardsItem    Item[] @relation(name: "rewards_item")
  rewardsItemIds Int[]

  rewardsTitle    Title[] @relation(name: "rewards_title")
  rewardsTitleIds Int[]

  unlocks Float?

  removedFromApi Boolean @default(false)
  
  views Int @default(0)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history AchievementHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)

  @@index([createdAt])
  @@index([name_de(ops: raw("gin_trgm_ops")), name_en(ops: raw("gin_trgm_ops")), name_es(ops: raw("gin_trgm_ops")), name_fr(ops: raw("gin_trgm_ops"))], type: Gin)
}

enum MasteryRegion {
  Tyria
  Desert
  Maguuma
  Tundra
  Jade
  Sky
  Unknown
}

model AchievementHistory {
  achievementId Int
  revisionId String

  achievement Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([achievementId, revisionId])
}

model AchievementGroup {
  id String @id
  
  name_de String
  name_en String
  name_es String
  name_fr String

  order Int
  
  achievementCategories AchievementCategory[]

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history AchievementGroupHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model AchievementGroupHistory {
  achievementGroupId String
  revisionId String

  achievementGroup AchievementGroup @relation(fields: [achievementGroupId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([achievementGroupId, revisionId])
}


model AchievementCategory {
  id Int @id
  
  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  achievementGroup AchievementGroup? @relation(fields: [achievementGroupId], references: [id])
  achievementGroupId String?

  order Int

  achievements Achievement[]   @relation("achievements")

  categoryDisplay   Achievement? @relation("categoryDisplay", fields: [categoryDisplayId], references: [id])
  categoryDisplayId Int?

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history AchievementCategoryHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model AchievementCategoryHistory {
  achievementCategoryId Int
  revisionId String

  achievementCategory AchievementCategory @relation(fields: [achievementCategoryId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([achievementCategoryId, revisionId])
}

model Revision {
  id String @id @default(uuid())

  entity String?

  schema String
  data String
  description String?
  type RevisionType @default(Update)

  language Language

  build Build @relation(fields: [buildId], references: [id])
  buildId Int
  
  createdAt DateTime @default(now())

  @@index([language, type])

  previousRevisionId String? @unique
  previousRevision   Revision? @relation("previous", fields: [previousRevisionId], references: [id])
  nextRevision       Revision? @relation("previous")

  // items
  currentItem_de Item? @relation("current_de")
  currentItem_en Item? @relation("current_en")
  currentItem_es Item? @relation("current_es")
  currentItem_fr Item? @relation("current_fr")
  itemHistory ItemHistory?
  
  // skills
  currentSkill_de Skill? @relation("current_de")
  currentSkill_en Skill? @relation("current_en")
  currentSkill_es Skill? @relation("current_es")
  currentSkill_fr Skill? @relation("current_fr")
  skillHistory SkillHistory[]
  
  // skins
  currentSkin_de Skin? @relation("current_de")
  currentSkin_en Skin? @relation("current_en")
  currentSkin_es Skin? @relation("current_es")
  currentSkin_fr Skin? @relation("current_fr")
  skinHistory SkinHistory[]
  
  // achievements
  currentAchievement_de Achievement? @relation("current_de")
  currentAchievement_en Achievement? @relation("current_en")
  currentAchievement_es Achievement? @relation("current_es")
  currentAchievement_fr Achievement? @relation("current_fr")
  achievementHistory AchievementHistory[]
  
  // achievement groups
  currentAchievementGroup_de AchievementGroup? @relation("current_de")
  currentAchievementGroup_en AchievementGroup? @relation("current_en")
  currentAchievementGroup_es AchievementGroup? @relation("current_es")
  currentAchievementGroup_fr AchievementGroup? @relation("current_fr")
  achievementGroupHistory AchievementGroupHistory[]
  
  // achievement categories
  currentAchievementCategory_de AchievementCategory? @relation("current_de")
  currentAchievementCategory_en AchievementCategory? @relation("current_en")
  currentAchievementCategory_es AchievementCategory? @relation("current_es")
  currentAchievementCategory_fr AchievementCategory? @relation("current_fr")
  achievementCategoryHistory AchievementCategoryHistory[]
  
  // currencies
  currentCurrency_de Currency? @relation("current_de")
  currentCurrency_en Currency? @relation("current_en")
  currentCurrency_es Currency? @relation("current_es")
  currentCurrency_fr Currency? @relation("current_fr")
  currencyHistory CurrencyHistory[]
  
  // titles
  currentTitle_de Title? @relation("current_de")
  currentTitle_en Title? @relation("current_en")
  currentTitle_es Title? @relation("current_es")
  currentTitle_fr Title? @relation("current_fr")
  titleHistory TitleHistory[]

  // recipes
  currentRecipe Recipe? @relation("current")
  recipeHistory RecipeHistory[]
  
  // colors
  currentColor_de Color? @relation("current_de")
  currentColor_en Color? @relation("current_en")
  currentColor_es Color? @relation("current_es")
  currentColor_fr Color? @relation("current_fr")
  colorHistory ColorHistory[]
  
  // colors
  currentGuildUpgrade_de GuildUpgrade? @relation("current_de")
  currentGuildUpgrade_en GuildUpgrade? @relation("current_en")
  currentGuildUpgrade_es GuildUpgrade? @relation("current_es")
  currentGuildUpgrade_fr GuildUpgrade? @relation("current_fr")
  guildUpgradeHistory GuildUpgradeHistory[]

  // wizards vault
  currentWizardsVaultListing WizardsVaultListing? @relation("current")
  wizardsVaultListingHistory WizardsVaultListingHistory[]
  
  currentWizardsVaultObjective_de WizardsVaultObjective? @relation("current_de")
  currentWizardsVaultObjective_en WizardsVaultObjective? @relation("current_en")
  currentWizardsVaultObjective_es WizardsVaultObjective? @relation("current_es")
  currentWizardsVaultObjective_fr WizardsVaultObjective? @relation("current_fr")
  wizardsVaultObjectiveHistory WizardsVaultObjectiveHistory[]
  
  currentWizardsVaultSeason_de WizardsVaultSeason? @relation("current_de")
  currentWizardsVaultSeason_en WizardsVaultSeason? @relation("current_en")
  currentWizardsVaultSeason_es WizardsVaultSeason? @relation("current_es")
  currentWizardsVaultSeason_fr WizardsVaultSeason? @relation("current_fr")
  wizardsVaultSeasonHistory WizardsVaultSeasonHistory[]

  // homestead decorations
  currentHomesteadDecoration_de HomesteadDecoration? @relation("current_de")
  currentHomesteadDecoration_en HomesteadDecoration? @relation("current_en")
  currentHomesteadDecoration_es HomesteadDecoration? @relation("current_es")
  currentHomesteadDecoration_fr HomesteadDecoration? @relation("current_fr")
  homesteadDecorationHistory HomesteadDecorationHistory[]

  // homestead decorations categories
  currentHomesteadDecorationCategory_de HomesteadDecorationCategory? @relation("current_de")
  currentHomesteadDecorationCategory_en HomesteadDecorationCategory? @relation("current_en")
  currentHomesteadDecorationCategory_es HomesteadDecorationCategory? @relation("current_es")
  currentHomesteadDecorationCategory_fr HomesteadDecorationCategory? @relation("current_fr")
  homesteadDecorationCategoryHistory HomesteadDecorationCategoryHistory[]
  
  // homestead glyphs
  currentHomesteadGlyph HomesteadGlyph? @relation("current")
  homesteadGlyphHistory HomesteadGlyphHistory[]

  //minis
  currentMini_de Mini? @relation("current_de")
  currentMini_en Mini? @relation("current_en")
  currentMini_es Mini? @relation("current_es")
  currentMini_fr Mini? @relation("current_fr")
  miniHistory MiniHistory[]
}

enum RevisionType {
  Update
  Import
  Added
  Removed
}

model Build {
  id Int @id

  revisions Revision[]
  
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

model Currency {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  order Int

  containedIn CurrencyContent[] @relation("containedCurrency")

  ingredient RecipeIngredient[]

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history CurrencyHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model CurrencyHistory {
  currencyId Int
  revisionId String

  currency Currency @relation(fields: [currencyId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([currencyId, revisionId])
}

model Title {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  achievements Achievement[] @relation(name: "rewards_title")

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history TitleHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model TitleHistory {
  titleId Int
  revisionId String

  title Title @relation(fields: [titleId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([titleId, revisionId])
}

model Color {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  cloth_rgb   String @default("")
  leather_rgb String @default("")
  metal_rgb   String @default("")

  unlockedByItems Item[] @relation("unlocks_color")

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history ColorHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model ColorHistory {
  colorId Int
  revisionId String

  color Color @relation(fields: [colorId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([colorId, revisionId])
}

model GuildUpgrade {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  ingredient   RecipeIngredient[]
  recipeOutput Recipe[] @relation(name: "recipe_output")
  
  unlockedByItems Item[] @relation("unlocks_guild_upgrade")

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history GuildUpgradeHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model GuildUpgradeHistory {
  guildUpgradeId Int
  revisionId String

  guildUpgrade GuildUpgrade @relation(fields: [guildUpgradeId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([guildUpgradeId, revisionId])
}

model WizardsVaultSeason {
  id String @id @default(uuid())

  name_de String
  name_en String
  name_es String
  name_fr String

  start DateTime @unique
  end   DateTime
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history WizardsVaultSeasonHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model WizardsVaultSeasonHistory {
  wizardsVaultSeasonId String
  revisionId String

  wizardsVaultSeason WizardsVaultSeason @relation(fields: [wizardsVaultSeasonId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([wizardsVaultSeasonId, revisionId])
}

model WizardsVaultListing {
  id Int @id

  itemId    Int?
  item      Item? @relation("wizardsvault_listing", fields: [itemId], references: [id], onDelete: SetNull)
  itemIdRaw Int

  count Int
  type  WizardsVaultListingType
  cost  Int
  limit Int?

  removedFromApi Boolean @default(false)
  
  current Revision @relation("current", fields: [currentId], references: [id], onDelete: Cascade)
  currentId String @unique

  history WizardsVaultListingHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model WizardsVaultListingHistory {
  wizardsVaultListingId Int
  revisionId String

  guildUpgrade WizardsVaultListing @relation(fields: [wizardsVaultListingId], references: [id], onDelete: Cascade)
  revision     Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([wizardsVaultListingId, revisionId])
}

enum WizardsVaultListingType {
  Featured
  Normal
  Legacy
}

model WizardsVaultObjective {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  track   WizardsVaultTrack
  acclaim Int

  waypointId Int?

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history WizardsVaultObjectiveHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model WizardsVaultObjectiveHistory {
  wizardsVaultObjectiveId Int
  revisionId String

  guildUpgrade WizardsVaultObjective @relation(fields: [wizardsVaultObjectiveId], references: [id], onDelete: Cascade)
  revision     Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([wizardsVaultObjectiveId, revisionId])
}

enum WizardsVaultTrack {
  PvE
  PvP
  WvW
}

model HomesteadDecoration {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  maxCount Int?

  categories HomesteadDecorationCategory[]
  categoryIds Int[]

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history HomesteadDecorationHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model HomesteadDecorationHistory {
  homesteadDecorationId Int
  revisionId String

  homesteadDecoration HomesteadDecoration @relation(fields: [homesteadDecorationId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([homesteadDecorationId, revisionId])
}

model HomesteadDecorationCategory {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  decorations HomesteadDecoration[]

  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history HomesteadDecorationCategoryHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model HomesteadDecorationCategoryHistory {
  homesteadDecorationCategoryId Int
  revisionId String

  homesteadDecorationCategory HomesteadDecorationCategory @relation(fields: [homesteadDecorationCategoryId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([homesteadDecorationCategoryId, revisionId])
}

model HomesteadGlyph {
  id String @id

  slot HomesteadGlyphSlot

  itemId    Int?
  item      Item? @relation("homestead_glyph", fields: [itemId], references: [id], onDelete: SetNull)
  itemIdRaw Int

  removedFromApi Boolean @default(false)
  
  current Revision @relation("current", fields: [currentId], references: [id], onDelete: Cascade)
  currentId String @unique

  history HomesteadGlyphHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model HomesteadGlyphHistory {
  homesteadGlyphId String
  revisionId String

  homesteadGlyph HomesteadGlyph @relation(fields: [homesteadGlyphId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([homesteadGlyphId, revisionId])
}

enum HomesteadGlyphSlot {
  harvesting
  logging
  mining
}

model Mini {
  id Int @id

  name_de String
  name_en String
  name_es String
  name_fr String

  icon   Icon? @relation(fields: [iconId], references: [id])
  iconId Int?

  unlockedByItems Item[]        @relation("unlock")
  achievementBits Achievement[] @relation(name: "bits_mini")

  unlocks Float?
  
  removedFromApi Boolean @default(false)
  
  current_de Revision @relation("current_de", fields: [currentId_de], references: [id], onDelete: Cascade)
  currentId_de String @unique
  
  current_en Revision @relation("current_en", fields: [currentId_en], references: [id], onDelete: Cascade)
  currentId_en String @unique
  
  current_es Revision @relation("current_es", fields: [currentId_es], references: [id], onDelete: Cascade)
  currentId_es String @unique
  
  current_fr Revision @relation("current_fr", fields: [currentId_fr], references: [id], onDelete: Cascade)
  currentId_fr String @unique

  history MiniHistory[]
  
  lastCheckedAt  DateTime   @default(now())

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  version Int @default(0)
}

model MiniHistory {
  miniId Int
  revisionId String

  mini Mini @relation(fields: [miniId], references: [id], onDelete: Cascade)
  revision Revision @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@id([miniId, revisionId])
}

model Job {
  id String @id @default(uuid())
  
  priority Int @default(1)
  type String
  data Json

  state JobState @default(Queued)
  output String @default("")

  flags String[] @default([])

  cron String?
  
  scheduledAt DateTime @default(now())
  startedAt DateTime?
  finishedAt DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Language {
  de
  en
  es
  fr
}

enum JobState {
  Queued
  Running
  Success
  Error
}

model ApiRequest {
  id String @id @default(uuid())

  endpoint String
  queryParameters String
  
  status Int
  statusText String

  responseTimeMs Float
  
  createdAt DateTime @default(now())
}

model User {
  id String @id @default(uuid())

  name String  @unique

  email         String?
  emailVerified Boolean @default(false)

  roles UserRole[] @default([])

  sessions  UserSession[]  @relation("session")
  providers UserProvider[] @relation("provider")

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  reviewsRequested Review[] @relation("requester")
  reviewsReviewed  Review[] @relation("reviewer")

  applications Application[] @relation("application")
}

enum UserRole {
  Admin
}

model UserSession {
  id String @id @default(uuid())
  
  info String

  user   User @relation("session", fields: [userId], references: [id], onDelete: Cascade)
  userId String

  createdAt  DateTime  @default(now())
  lastUsedAt DateTime  @default(now())
  expiresAt  DateTime? @default(dbgenerated("(now() + '1 year'::interval)"))
}

model UserProvider {
  provider          String
  providerAccountId String

  @@id([provider, providerAccountId])

  displayName String

  accessToken          String?
  accessTokenExpiresAt DateTime?
  
  refreshToken          String?
  refreshTokenExpiresAt DateTime?

  scope String[] @default([])

  userId String
  user   User   @relation("provider", fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

model AuthorizationRequest {
  id String @id @default(uuid())

  state         String @unique
  code_verifier String

  returnTo String?

  createdAt DateTime @default(now())
  expiresAt DateTime
}

model Application {
  id String @id @default(uuid())

  name String

  apiKey String @unique

  origins String[]

  owner   User @relation("application", fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId String

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  requests ApplicationApiRequest[] @relation()
}

model Review {
  id String @id @default(uuid())

  requesterId String?
  requester   User?   @relation("requester", fields: [requesterId], references: [id], onDelete: SetNull)

  reviewerId  String?
  reviewer    User?   @relation("reviewer", fields: [reviewerId], references: [id], onDelete: SetNull)

  queue ReviewQueue
  changes Json
  state ReviewState @default(Open)

  relatedItemId Int?
  relatedItem   Item? @relation("itemReview", fields: [relatedItemId], references: [id], onDelete: Cascade)

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  reviewedAt DateTime?
}

enum ReviewQueue {
  ContainerContent
  MysticForge
}

enum ReviewState {
  Open
  Approved
  Rejected
}

model PageView {
  time DateTime @default(now())

  page   String
  pageId Int @default(0)

  asn Int?

  @@unique([time, page, pageId])
}

view PageView_daily {
  bucket DateTime @default(now())

  page   String
  pageId Int

  count Int

  @@unique([bucket, page, pageId])
}

model ApplicationApiRequest {
  requestId String

  time DateTime @default(now())

  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId String

  endpoint String

  @@unique([requestId, time, applicationId, endpoint])
}
